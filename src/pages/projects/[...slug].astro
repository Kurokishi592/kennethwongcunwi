---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const projects = (await getCollection('projects')).filter((p) => p.id.endsWith('.mdx'));
  return projects.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const projects = (await getCollection('projects')).filter((p) => p.id.endsWith('.mdx'));
const entry = projects.find((p) => p.slug === slug);
if (!entry) throw new Error(`Missing project: ${slug}`);

const { Content } = await render(entry);
---

<BaseLayout
  title={`${entry.data.title} | Kenneth Wong Cun Wi`}
  description={entry.data.subtitle}
  canonicalPath={`/projects/${entry.slug}/`}
  activeNav="projects"
>
  <section class="section">
    <div class="container">
      <div class="section-head">
        <h2>{entry.data.title}</h2>
        <p class="muted">{entry.data.subtitle}</p>
      </div>

      <article class="panel prose">
        <Content />
      </article>

      <div class="section-foot">
        <a class="button" href="/projects/">‚Üê Back to projects</a>
      </div>
    </div>
  </section>
</BaseLayout>
