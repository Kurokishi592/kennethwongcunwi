---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const posts = await getCollection('blog');
const entry = posts.find((p) => p.slug === slug);
if (!entry) throw new Error(`Missing post: ${slug}`);

const { Content } = await render(entry);
---

<BaseLayout
  title={`${entry.data.title} | Kenneth Wong Cun Wi`}
  description={entry.data.description}
  canonicalPath={`/blog/${entry.slug}/`}
  activeNav="blog"
>
  <section class="section">
    <div class="container">
      <div class="section-head">
        <h2>{entry.data.title}</h2>
        <p class="muted">{entry.data.description}</p>
      </div>

      <article class="panel prose">
        <Content />
      </article>

      <div class="section-foot">
        <a class="button" href="/blog/">‚Üê Back to blog</a>
      </div>
    </div>
  </section>
</BaseLayout>
